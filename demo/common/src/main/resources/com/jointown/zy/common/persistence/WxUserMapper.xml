<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jointown.zy.common.dao.WxUserDao">
	<resultMap id="ucUser" type="com.jointown.zy.common.model.UcUser">
		<id column="USER_ID" property="userId" jdbcType="INTEGER" />
		<result column="USER_NAME" property="userName" jdbcType="VARCHAR" />
		<result column="PASSWORD" property="password" jdbcType="VARCHAR" />
		<result column="SALT" property="salt" jdbcType="VARCHAR" />
		<result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
		<result column="EMAIL" property="email" jdbcType="VARCHAR" />
		<result column="ACCESS_IP" property="accessIp" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		<result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="EXPIRE_TIME" property="expireTime" jdbcType="TIMESTAMP" />
		<result column="LAST_ACCESS_TIME" property="lastAccessTime"
			jdbcType="TIMESTAMP" />
		<result column="STATUS" property="status" jdbcType="INTEGER" />
		<result column="COMPANYNAME" property="companyName" jdbcType="VARCHAR" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="CERTIFY" property="certifyStatus" jdbcType="INTEGER" />
		<result column="ACCESS_TIME" property="AccessTime" jdbcType="TIMESTAMP" />
	</resultMap>


	<!-- lichenxiao 根据会员帐号和密码查询会员信息 start -->
	<select id="selectByCondition" parameterType="string"
		 resultMap="ucUser">
		<![CDATA[
			select * from BOSS.UC_USER where USER_NAME=#{userName} and "STATUS" <> 1
		]]>
	</select>
	<!-- lichenxiao 根据会员帐号和密码查询会员信息 end -->


	<select id="findUcUserByMobile" parameterType="string"
		resultType="com.jointown.zy.common.model.UcUser">
		select * from boss.uc_user where mobile=#{mobile} and
		status = 0
	</select>

<!-- 	新增会员 
	<insert id="addUcUser" parameterType="com.jointown.zy.common.model.UcUser">
		<![CDATA[
			insert into boss.uc_user
			(user_id,user_name,password,salt,mobile,create_time,update_time,access_ip,companyName,remark,certify)
			values (boss.seq_uc_user.nextval,
			#{userName,jdbcType=VARCHAR},
			#{password,jdbcType=VARCHAR},
			#{salt,jdbcType=VARCHAR},
			#{mobile,jdbcType=VARCHAR},
			#{createTime,jdbcType=TIMESTAMP},
			#{createTime,jdbcType=TIMESTAMP},
			#{accessIp,jdbcType=VARCHAR},
			#{companyName,jdbcType=VARCHAR},
			#{remark,jdbcType=VARCHAR},
			0)
		]]>
	</insert> -->

	<!-- 条件查询、模糊查询会员 -->
	<select id="findMemberByCondition" parameterType="String"
		resultType="com.jointown.zy.common.model.UcUser" resultMap="ucUser">
		<![CDATA[
			select * from (select * from boss.uc_user order by update_time desc) where 1=1
		]]>
		<if test="mobile != null and '' != mobile">
			<![CDATA[
				AND mobile = #{mobile}
			]]>
		</if>
		<if test="userName != null and '' != userName">
			<![CDATA[
				AND user_name like '%${userName}%'
			]]>
		</if>
		<if test="companyName != null and '' != companyName">
			<![CDATA[
				AND companyname like '%${companyName}%'
			]]>
		</if>
		<if test="regStartDate != null and '' != regStartDate">
			<![CDATA[
				AND create_time > to_date(#{regStartDate},'yyyy-mm-dd hh24:mi:ss')
			]]>
		</if>
		<if test="regEndDate != null and '' != regEndDate">
			<![CDATA[
				AND create_time < to_date(#{regEndDate},'yyyy-mm-dd hh24:mi:ss')
			]]>
		</if>
		<![CDATA[
			AND rownum <= 10  AND status in (0,2)
		]]>
	</select>

	<!-- 前台会员中心修改密码 -->
	<update id="updateUcUserPassword" parameterType="com.jointown.zy.common.model.UcUser">
		update
		boss.uc_user set
		password = #{password},
		salt = #{salt},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP}
		WHERE user_name = #{userName}
	</update>

	<!-- 前台会员中心修改手机号码 -->
	<update id="updateUcUserMobile" parameterType="com.jointown.zy.common.model.UcUser">
		update
		boss.uc_user set
		mobile = #{mobile},
		update_time = #{updateTime}
		WHERE
		user_name = #{userName}
	</update>

	<!-- 前台会员中心修改公司名称或姓名 -->
	<update id="updateUcUserCompany" parameterType="com.jointown.zy.common.model.UcUser">
		update
		boss.uc_user set
		companyname = #{companyName},
		update_time =
		#{updateTime}
		WHERE user_name = #{userName}
	</update>

	<!-- 前台会员中心修改邮箱 -->
	<update id="updateUcUserEmail" parameterType="com.jointown.zy.common.model.UcUser">
		update boss.uc_user
		set
		email = #{email},
		update_time = #{updateTime}
		WHERE user_name =
		#{userName}
	</update>

	<!-- 修改会员信息 -->
	<update id="updateUcUserInfo" parameterType="com.jointown.zy.common.model.UcUser">
		update boss.uc_user
		set
		email = #{email},
		mobile = #{mobile},
		update_time = #{updateTime},
		companyName = #{companyName},
		remark = #{remark}
		WHERE user_id =
		#{userId}
	</update>

	<!-- 修改会员登录信息 -->
	<update id="updateUcUserLoginInfo" parameterType="com.jointown.zy.common.model.UcUser">
		update
		boss.uc_user set
		access_ip = #{accessIp},
		last_access_time=access_time,
		access_time = #{AccessTime},
		update_time = #{updateTime}
		WHERE user_id =
		#{userId}
	</update>

	<!-- 删除会员 -->
	<update id="deleteUcUser" parameterType="String">
		<![CDATA[
		update boss.uc_user set
		status = 1
		WHERE user_id = #{userId} AND status <> 1
		]]>
	</update>

	<!-- 锁定和解锁会员 -->
	<update id="lockUcUser" parameterType="String">
		<![CDATA[
			update boss.uc_user set 
			status=#{status}
			WHERE user_id = #{userId} AND status <> 1
		]]>
	</update>

	<!-- 密码重置 -->
	<update id="secretReset" parameterType="String">
		<![CDATA[
			update boss.uc_user set
			password = #{password},
			salt = #{salt}
			WHERE user_id = #{userId}
		]]>
	</update>

	<!-- 判断手机号是否存在 -->
	<select id="findMemberMobile" parameterType="String" resultMap="ucUser">
		<![CDATA[
			select * from boss.uc_user where mobile=#{mobile} AND status <> 1
		]]>
	</select>

	<!-- 修改会员时判断手机号是否存在 -->
	<select id="findUcUserByMobAndId" parameterType="String"
		resultMap="ucUser">
		<![CDATA[
			select * from boss.uc_user where mobile=#{mobile} and user_id<>#{userId} AND status <> 1
		]]>
	</select>

	<!-- 查询该会员是否已删除 -->
	<select id="findMemberByAllUserName" parameterType="String"
		resultMap="ucUser">
		<![CDATA[
			select * from boss.uc_user where user_name=#{userName} AND status = 1
		]]>
	</select>

	<!-- 如果该会员已删除，新会员添加时可以清空update -->
	<update id="updateMemberByUserName" parameterType="ucUser">
		<![CDATA[
			update boss.uc_user set 
			password = #{password,jdbcType=VARCHAR},
			salt = #{salt,jdbcType=VARCHAR},
			mobile = #{mobile,jdbcType=VARCHAR},
			create_time = #{createTime,jdbcType=TIMESTAMP},
			update_time = #{createTime,jdbcType=TIMESTAMP},
			access_ip = #{accessIp,jdbcType=VARCHAR},
			companyName = #{companyName,jdbcType=VARCHAR},
			email = #{email,jdbcType=VARCHAR},
			remark = #{remark,jdbcType=VARCHAR},
			status = 0
			where user_name = #{userName,jdbcType=VARCHAR} AND status=1
		]]>
	</update>
</mapper>