!function(o,t){var n={crop:!0,uploadUrl:"",uploadData:{},cropUrl:"",cropData:{},imgEyecandy:!0,imgEyecandyOpacity:.2,initialZoom:40,zoomFactor:10,rotateFactor:5,doubleZoomControls:!0,rotateControls:!0,customUploadButtonId:"",loaderHtml:"",scaleToFill:!0,processInline:!1,loadPicture:"",onReset:null,enableMousescroll:!1,onBeforeImgUpload:null,onAfterImgUpload:null,onImgDrag:null,onImgZoom:null,onImgRotate:null,onBeforeImgCrop:null,onAfterImgCrop:null,onBeforeRemoveCroppedImg:null,onAfterRemoveCroppedImg:null,onError:null};Croppic=function(o,t){this.id=o,this.options=$.extend({},n,t||{}),this.obj=$("#"+o),this.objW=this.obj.width(),this.objH=this.obj.height(),this.wait=!1,this.init()},Croppic.prototype={imgInitW:0,imgInitH:0,imgW:0,imgH:0,obj:{},outputDiv:{},outputUrlObj:{},img:{},imgEyecandy:{},form:{},iframeform:{},iframeobj:{},cropControlsUpload:{},cropControlsCrop:{},cropControlZoomMuchIn:{},cropControlZoomMuchOut:{},cropControlZoomIn:{},cropControlZoomOut:{},cropControlCrop:{},cropControlReset:{},cropControlRemoveCroppedImage:{},loader:{},init:function(){var o=this;this.actualRotation=0,o.createImgUploadControls(),$.isEmptyObject(o.options.loadPicture)?o.bindImgUploadControl():o.loadExistingImage()},createImgUploadControls:function(){var o=this;""===o.options.customUploadButtonId&&$.isEmptyObject(o.options.loadPicture)?(o.obj.append('<div class="cropControls cropControlsUpload"><i class="cropControlUpload"></i></div>'),o.imgUploadControl=o.obj.find(".cropControlUpload")):(o.imgUploadControl=$("#"+o.options.customUploadButtonId),o.imgUploadControl.show())},bindImgUploadControl:function(){var o=this,n='<form class="'+o.id+'_imgUploadForm" style="visibility: hidden;">  <input type="file" name="img" id="'+o.id+'_imgUploadField">  </form>';o.obj.append(n),o.form=o.obj.find("."+o.id+"_imgUploadForm");var e=o.CreateFallbackIframe();o.imgUploadControl.off("click.upfile"),o.imgUploadControl.on("click.upfile",function(){o.wait||(""===e?o.form.find('input[type="file"]').trigger("click"):o.iframeform.find('input[type="file"]').trigger("click"))}),o.form.on("change","input",function(){o.options.onBeforeImgUpload&&o.options.onBeforeImgUpload.call(o),o.showLoader();try{formData=new FormData(o.form[0])}catch(n){formData=new FormData,formData.append("img",o.form.find("input[type=file]")[0].files[0])}for(var e in o.options.uploadData)o.options.uploadData.hasOwnProperty(e)&&formData.append(e,o.options.uploadData[e]);o.wait=!0,$.ajax({url:o.options.uploadUrl,data:formData,context:t.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(t){o.afterUpload(t),o.wait=!1})})},loadExistingImage:function(){var o=this;o.options.onBeforeImgUpload&&o.options.onBeforeImgUpload.call(o),o.showLoader(),o.imgUrl=o.options.loadPicture;var t=$('<img src="'+o.options.loadPicture+'">');o.obj.append(t),t.load(function(){o.imgInitW=o.imgW=this.width,o.imgInitH=o.imgH=this.height,o.initCropper(),o.hideLoader(),o.options.onAfterImgUpload&&o.options.onAfterImgUpload.call(o)})},afterUpload:function(o){var t=this;if(response="object"==typeof o?o:jQuery.parseJSON(o),"success"==response.status){t.imgInitW=t.imgW=response.width,t.imgInitH=t.imgH=response.height,t.imgUrl=response.url;var n=$('<img src="'+response.url+'">');t.obj.append(n),n.load(function(){t.initCropper(),t.hideLoader()}),t.options.onAfterImgUpload&&t.options.onAfterImgUpload.call(t,response)}"error"==response.status&&(t.options.onError&&t.options.onError.call(t,response),t.hideLoader(),t.reset())},initCropper:function(){var o=this;o.img=o.obj.find("img"),o.img.wrap('<div class="cropImgWrapper" style="overflow:hidden; z-index:1; position:absolute; width:'+o.objW+"px; height:"+o.objH+'px;"></div>'),o.createCropControls(),o.options.imgEyecandy&&o.createEyecandy(),o.initDrag(),o.initialScaleImg()},createEyecandy:function(){var o=this;o.imgEyecandy=o.img.clone(),o.imgEyecandy.css({"z-index":"0",opacity:o.options.imgEyecandyOpacity}).appendTo(o.obj)},destroyEyecandy:function(){var o=this;o.imgEyecandy.remove()},initialScaleImg:function(){var o=this;o.zoom(-o.imgInitW),o.zoom(o.options.initialZoom),o.options.enableMousescroll&&o.img.on("mousewheel",function(t){t.preventDefault(),o.zoom(o.options.zoomFactor*t.deltaY)}),o.img.css({left:-(o.imgW-o.objW)/2,top:-(o.imgH-o.objH)/2,position:"relative"}),o.options.imgEyecandy&&o.imgEyecandy.css({left:-(o.imgW-o.objW)/2,top:-(o.imgH-o.objH)/2,position:"relative"})},createCropControls:function(){var o,t=this,n="",e='<i class="cropControlZoomIn"></i>',i='<i class="cropControlZoomOut"></i>',r="",a="",s="",p='<i class="cropControlCrop"></i>',c='<i class="cropControlReset"></i>';t.options.doubleZoomControls&&(n='<i class="cropControlZoomMuchIn"></i>',r='<i class="cropControlZoomMuchOut"></i>'),t.options.rotateControls&&(a='<i class="cropControlRotateLeft"></i>',s='<i class="cropControlRotateRight"></i>'),o='<div class="cropControls cropControlsCrop">'+n+e+i+r+a+s+p+c+"</div>",t.obj.append(o),t.cropControlsCrop=t.obj.find(".cropControlsCrop"),t.options.doubleZoomControls&&(t.cropControlZoomMuchIn=t.cropControlsCrop.find(".cropControlZoomMuchIn"),t.cropControlZoomMuchIn.on("click",function(){t.zoom(10*t.options.zoomFactor)}),t.cropControlZoomMuchOut=t.cropControlsCrop.find(".cropControlZoomMuchOut"),t.cropControlZoomMuchOut.on("click",function(){t.zoom(10*-t.options.zoomFactor)})),t.cropControlZoomIn=t.cropControlsCrop.find(".cropControlZoomIn"),t.cropControlZoomIn.on("click",function(){t.zoom(t.options.zoomFactor)}),t.cropControlZoomOut=t.cropControlsCrop.find(".cropControlZoomOut"),t.cropControlZoomOut.on("click",function(){t.zoom(-t.options.zoomFactor)}),t.cropControlZoomIn=t.cropControlsCrop.find(".cropControlRotateLeft"),t.cropControlZoomIn.on("click",function(){t.rotate(-t.options.rotateFactor)}),t.cropControlZoomOut=t.cropControlsCrop.find(".cropControlRotateRight"),t.cropControlZoomOut.on("click",function(){t.rotate(t.options.rotateFactor)}),t.cropControlCrop=t.cropControlsCrop.find(".cropControlCrop"),t.cropControlCrop.on("click",function(){t.crop()}),t.cropControlReset=t.cropControlsCrop.find(".cropControlReset"),t.cropControlReset.on("click",function(){t.reset()})},initDrag:function(){var t=this;t.img.on("mousedown touchstart",function(n){n.preventDefault();var e,i,r=o.navigator.userAgent;r.match(/iPad/i)||r.match(/iPhone/i)||r.match(/android/i)||void 0==(n.pageY&&n.pageX)?(e=n.originalEvent.touches[0].pageX,i=n.originalEvent.touches[0].pageY):(e=n.pageX,i=n.pageY);var a=t.img.css("z-index"),s=t.img.outerHeight(),p=t.img.outerWidth(),c=t.img.offset().top+s-i,l=t.img.offset().left+p-e;t.img.css("z-index",1e3).on("mousemove touchmove",function(o){var n,e;if(r.match(/iPad/i)||r.match(/iPhone/i)||r.match(/android/i)||void 0==(o.pageY&&o.pageX)?(n=o.originalEvent.touches[0].pageY+c-s,e=o.originalEvent.touches[0].pageX+l-p):(n=o.pageY+c-s,e=o.pageX+l-p),t.img.offset({top:n,left:e}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",a)}),t.options.imgEyecandy&&t.imgEyecandy.offset({top:n,left:e}),t.objH<t.imgH){parseInt(t.img.css("top"))>0&&(t.img.css("top",0),t.options.imgEyecandy&&t.imgEyecandy.css("top",0));var i=-(t.imgH-t.objH);parseInt(t.img.css("top"))<i&&(t.img.css("top",i),t.options.imgEyecandy&&t.imgEyecandy.css("top",i))}else{parseInt(t.img.css("top"))<0&&(t.img.css("top",0),t.options.imgEyecandy&&t.imgEyecandy.css("top",0));var i=t.objH-t.imgH;parseInt(t.img.css("top"))>i&&(t.img.css("top",i),t.options.imgEyecandy&&t.imgEyecandy.css("top",i))}if(t.objW<t.imgW){parseInt(t.img.css("left"))>0&&(t.img.css("left",0),t.options.imgEyecandy&&t.imgEyecandy.css("left",0));var m=-(t.imgW-t.objW);parseInt(t.img.css("left"))<m&&(t.img.css("left",m),t.options.imgEyecandy&&t.imgEyecandy.css("left",m))}else{parseInt(t.img.css("left"))<0&&(t.img.css("left",0),t.options.imgEyecandy&&t.imgEyecandy.css("left",0));var m=t.objW-t.imgW;parseInt(t.img.css("left"))>m&&(t.img.css("left",m),t.options.imgEyecandy&&t.imgEyecandy.css("left",m))}t.options.onImgDrag&&t.options.onImgDrag.call(t)})}).on("mouseup",function(){t.img.off("mousemove")}).on("mouseout",function(){t.img.off("mousemove")})},rotate:function(o){var t=this;t.actualRotation+=o,t.img.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"}),t.options.imgEyecandy&&t.imgEyecandy.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"}),"function"==typeof t.options.onImgRotate&&t.options.onImgRotate.call(t)},zoom:function(o){var t=this,n=t.imgW/t.imgH,e=t.imgW+o,i=e/n,r=!0;(e<t.objW||i<t.objH)&&(e-t.objW<i-t.objH?(e=t.objW,i=e/n):(i=t.objH,e=n*i),r=!1),!t.options.scaleToFill&&(e>t.imgInitW||i>t.imgInitH)&&(e-t.imgInitW<i-t.imgInitH?(e=t.imgInitW,i=e/n):(i=t.imgInitH,e=n*i),r=!1),t.imgW=e,t.img.width(e),t.imgH=i,t.img.height(i);var a=parseInt(t.img.css("top"))-o/2,s=parseInt(t.img.css("left"))-o/2;a>0&&(a=0),s>0&&(s=0);var p=-(i-t.objH);p>a&&(a=p);var c=-(e-t.objW);c>s&&(s=c),r&&t.img.css({top:a,left:s}),t.options.imgEyecandy&&(t.imgEyecandy.width(e),t.imgEyecandy.height(i),r&&t.imgEyecandy.css({top:a,left:s})),t.options.onImgZoom&&t.options.onImgZoom.call(t)},crop:function(){var o=this;o.options.onBeforeImgCrop&&o.options.onBeforeImgCrop.call(o),o.cropControlsCrop.hide(),o.showLoader();var n,e={imgUrl:o.imgUrl,imgInitW:o.imgInitW,imgInitH:o.imgInitH,imgW:o.imgW,imgH:o.imgH,imgY1:Math.abs(parseInt(o.img.css("top"))),imgX1:Math.abs(parseInt(o.img.css("left"))),cropH:o.objH,cropW:o.objW,rotation:o.actualRotation};if("undefined"==typeof FormData){var i=new XMLHttpRequest,r="",a=[];for(var s in e)a.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));for(var s in o.options.cropData)a.push(encodeURIComponent(s)+"="+encodeURIComponent(o.options.cropData[s]));r=a.join("&").replace(/%20/g,"+"),i.addEventListener("error",function(){o.options.onError&&o.options.onError.call(o,"XHR Request failed")}),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&o.afterCrop(i.responseText)},i.open("POST",o.options.cropUrl),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Content-Length",r.length),i.send(r)}else{n=new FormData;for(var s in e)e.hasOwnProperty(s)&&n.append(s,e[s]);for(var s in o.options.cropData)o.options.cropData.hasOwnProperty(s)&&n.append(s,o.options.cropData[s]);$.ajax({url:o.options.cropUrl,data:n,context:t.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(t){o.afterCrop(t)})}},afterCrop:function(o){var t=this;try{response=jQuery.parseJSON(o)}catch(n){response="object"==typeof o?o:jQuery.parseJSON(o)}"success"==response.status&&(t.options.imgEyecandy&&t.imgEyecandy.hide(),t.destroy(),t.obj.append('<img class="croppedImg" src="'+response.url+'">'),t.init(),t.hideLoader()),"error"==response.status&&(t.options.onError&&t.options.onError.call(t,response.message),t.hideLoader(),setTimeout(function(){t.reset()},2e3)),t.options.onAfterImgCrop&&t.options.onAfterImgCrop.call(t,response)},showLoader:function(){var o=this;o.options.crop?(o.obj.append(o.options.loaderHtml),o.loader=o.obj.find(".loader")):o.options.customUploadButtonId&&(o.imgUploadControl.html(o.options.loaderHtml),o.loader=o.imgUploadControl.find(".loader"))},hideLoader:function(){var o=this;o.loader.remove()},reset:function(){var o=this;o.destroy(),o.init(),"function"==typeof o.options.onReset&&o.options.onReset.call(o)},destroy:function(){var o=this;o.imgUploadControl&&o.imgUploadControl.off("click.upfile"),o.options.imgEyecandy&&!$.isEmptyObject(o.imgEyecandy)&&o.destroyEyecandy(),$.isEmptyObject(o.cropControlsUpload)||o.cropControlsUpload.remove(),$.isEmptyObject(o.cropControlsCrop)||o.cropControlsCrop.remove(),$.isEmptyObject(o.loader)||o.loader.remove(),$.isEmptyObject(o.form)||o.form.remove(),o.options.loadPicture="",o.obj.html("")},isAjaxUploadSupported:function(){var o=t.createElement("input");return o.type="file","multiple"in o&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},CreateFallbackIframe:function(){var o=this;if(o.isAjaxUploadSupported())return"";if(jQuery.isEmptyObject(o.iframeobj)){var n=t.createElement("iframe");n.setAttribute("id",o.id+"_upload_iframe"),n.setAttribute("name",o.id+"_upload_iframe"),n.setAttribute("width","0"),n.setAttribute("height","0"),n.setAttribute("border","0"),n.setAttribute("src","javascript:false;"),n.style.display="none",t.body.appendChild(n)}else n=o.iframeobj[0];var e='<!DOCTYPE html><html><head><title>Uploading File</title></head><body><form class="'+o.id+'_upload_iframe_form" name="'+o.id+'_upload_iframe_form" action="'+o.options.uploadUrl+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" style="display:none;">'+$("#"+o.id+"_imgUploadField")[0].outerHTML+"</form></body></html>";n.contentWindow.document.open("text/htmlreplace"),n.contentWindow.document.write(e),n.contentWindow.document.close(),o.iframeobj=$("#"+o.id+"_upload_iframe"),o.iframeform=o.iframeobj.contents().find("html").find("."+o.id+"_upload_iframe_form"),o.iframeform.on("change","input",function(){o.SubmitFallbackIframe(o)}),o.iframeform.find("input")[0].attachEvent("onchange",function(){o.wait=!0,o.SubmitFallbackIframe(o)});var i=function(){n.detachEvent?n.detachEvent("onload",i):n.removeEventListener("load",i,!1);var t=o.getIframeContentJSON(n);o.afterUpload(t),o.wait=!1};return n.addEventListener&&n.addEventListener("load",i,!0),n.attachEvent&&n.attachEvent("onload",i),"#"+o.id+"_imgUploadField"},SubmitFallbackIframe:function(o){o.showLoader(),o.options.processInline&&!o.options.uploadUrl?o.options.onError&&(o.options.onError.call(o,"processInline is not supported by your browser "),o.hideLoader()):(o.options.onBeforeImgUpload&&o.options.onBeforeImgUpload.call(o),o.iframeform[0].submit())},getIframeContentJSON:function(o){try{var t,n=o.contentDocument?o.contentDocument:o.contentWindow.document,e=n.body.innerHTML;"<pre>"==e.slice(0,5).toLowerCase()&&"</pre>"==e.slice(-6).toLowerCase()&&(e=n.body.firstChild.firstChild.nodeValue),t=jQuery.parseJSON(e)}catch(i){t={success:!1}}return t}}}(window,document);